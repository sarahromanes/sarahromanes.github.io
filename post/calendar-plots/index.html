<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.40.2" />
  <meta name="author" content="Sarah Romanes">

  
  
  
  
    
      
    
  
  <meta name="description" content="Ah, back to reality!Last month, I was fortunate enough to be able to travel away from the cold Sydney winter over to Central and North America for a holiday and also to present my work on multiDA at JSM in Vancouver. Whilst at JSM, I was able to hear Earo present her work (along with Di and Rob) on making calendar plots in R, using data from pedestrian traffic in Melbourne (see more here).">

  
  <link rel="alternate" hreflang="en-us" href="/post/calendar-plots/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Playfair&#43;Display:400,700%7cFauna&#43;One">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Sarah Romanes">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Sarah Romanes">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/calendar-plots/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@sarah_romanes">
  <meta property="twitter:creator" content="@sarah_romanes">
  
  <meta property="og:site_name" content="Sarah Romanes">
  <meta property="og:url" content="/post/calendar-plots/">
  <meta property="og:title" content="An argument for eating that pizza whilst on vacation - exploring the sugrrants package | Sarah Romanes">
  <meta property="og:description" content="Ah, back to reality!Last month, I was fortunate enough to be able to travel away from the cold Sydney winter over to Central and North America for a holiday and also to present my work on multiDA at JSM in Vancouver. Whilst at JSM, I was able to hear Earo present her work (along with Di and Rob) on making calendar plots in R, using data from pedestrian traffic in Melbourne (see more here).">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-08-08T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-08-08T00:00:00&#43;00:00">
  

  
  

  <title>An argument for eating that pizza whilst on vacation - exploring the sugrrants package | Sarah Romanes</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Sarah Romanes</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#packages">
            
            <span>Packages</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">An argument for eating that pizza whilst on vacation - exploring the sugrrants package</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-08-08 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Aug 8, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sarah Romanes">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/data-viz/">data-viz</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=An%20argument%20for%20eating%20that%20pizza%20whilst%20on%20vacation%20-%20exploring%20the%20sugrrants%20package&amp;url=%2fpost%2fcalendar-plots%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fcalendar-plots%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fcalendar-plots%2f&amp;title=An%20argument%20for%20eating%20that%20pizza%20whilst%20on%20vacation%20-%20exploring%20the%20sugrrants%20package"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fcalendar-plots%2f&amp;title=An%20argument%20for%20eating%20that%20pizza%20whilst%20on%20vacation%20-%20exploring%20the%20sugrrants%20package"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=An%20argument%20for%20eating%20that%20pizza%20whilst%20on%20vacation%20-%20exploring%20the%20sugrrants%20package&amp;body=%2fpost%2fcalendar-plots%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <div id="ah-back-to-reality" class="section level1">
<h1>Ah, back to reality!</h1>
<p>Last month, I was fortunate enough to be able to travel away from the cold Sydney winter over to Central and North America for a holiday and also to present my work on multiDA at JSM in Vancouver. Whilst at JSM, I was able to hear <a href="https://twitter.com/earowang"><strong>Earo</strong></a> present her work (along with <a href="https://twitter.com/visnut"><strong>Di</strong></a> and <a href="https://twitter.com/robjhyndman"><strong>Rob</strong></a>) on making calendar plots in R, using data from pedestrian traffic in Melbourne (see more <a href="https://github.com/earowang/sugrrants"><strong>here</strong></a>). I was super impressed by my work, and on my flight home I realised I could also have a crack at using the package by analysing my own step count data. I felt like I had walked a lot more whilst I was travelling - would the visualisation agree?</p>
<center>
<p><img src="/img/cruise.jpg" width="700px" /></p>
</center>
</div>
<div id="step-count-visualisation-from-my-iphone-with-sugrrants" class="section level1">
<h1>Step count visualisation from my iPhone with <code>sugrrants</code></h1>
<div id="export-data-off-the-iphone" class="section level3">
<h3>1) Export data off the iPhone</h3>
<p>I use the <a href="http://quantifiedself.com/qs-access-app/"><strong>QS Access App</strong></a> to export data from Apple Health into an easy to load <code>.csv</code> format for analysis. If you have a Samsung like I did before (you’ll be able to notice on the resultant calendar plot the day and time I switched over), it is <strong>much</strong> more difficult to export data from Samsung health. I had planned to combine that data with my iPhone data to no avail, the steps are long and require you to download old SDK’s from github and enable developer mode (see more <a href="https://android.stackexchange.com/questions/117112/is-it-possible-to-export-the-s-health-data-from-a-samsung-s6-into-a-usable-data"><strong>here</strong></a>). In the end, the data I managed to get off completely struck off the date component, and it seemed like my Samsung was counting fake steps when I was sleeping every night at around 3-4am. Rubbish data.</p>
<center>
<p><img src="/img/garbage.gif" height="200"></p>
</center>
<p>Onwards and upwards with the iPhone data!</p>
</div>
<div id="some-data-cleaning" class="section level3">
<h3>2) Some data cleaning</h3>
<p>Before we go any further, we are going to have to load some libraries into R. To save time, you could simply load the <code>tidyverse</code> package for all requirements to be loaded. Specifically, we will be using the <code>dplyr</code> and <code>lubridate</code> packages for this step.</p>
<p>The <code>steps_export.csv</code> file contains <strong>three</strong> variables - the start date time for when data was collected, the finish date time, and the number of steps in that period. The data is grouped by the hour, which is very handy. We first rename the column names for ease of analysis, and use the <code>lubridate</code> package to convert our date into something sensible that R can understand (it is initially read in as a factor). We then use the <code>dplyr</code> package to create new Time and Date columns, which is needed by the <code>sugrrants</code> package later on.</p>
<pre class="r"><code>library(lubridate)
library(dplyr)
library(stringr)

data &lt;- read.csv(&quot;steps_export.csv&quot;)
colnames(data) &lt;- c(&quot;Start&quot;, &quot;Finish&quot;, &quot;Count&quot;)
data &lt;- mutate_at(data, vars(-Count), funs(dmy_hm(.)))
data &lt;- data %&gt;% select (-c(Start)) #drop `Start` variable - only care about counts at the end of the hour.

data &lt;- mutate(data, Time=hour(Finish))
data &lt;- mutate(data, Date=date(Finish))

head(data)</code></pre>
<pre><code>##                Finish     Count Time       Date
## 1 2018-06-17 17:00:00 347.00000   17 2018-06-17
## 2 2018-06-17 18:00:00  22.00000   18 2018-06-17
## 3 2018-06-17 19:00:00 114.17046   19 2018-06-17
## 4 2018-06-17 20:00:00  20.82954   20 2018-06-17
## 5 2018-06-17 21:00:00   0.00000   21 2018-06-17
## 6 2018-06-17 22:00:00   0.00000   22 2018-06-17</code></pre>
</div>
<div id="generate-an-intial-calendar-plot" class="section level3">
<h3>3) Generate an intial calendar plot</h3>
<p>To generate our calendar plot, we use the <code>sugrrants</code> package to transform our data frame into a frame_calendar format, which allows `<code>ggplot2</code> to effectively plot the data in a calendar format. More details about the usage of the package can be found <a href="https://pkg.earo.me/sugrrants/articles/frame-calendar.html"><strong>here</strong></a>, and the nifty tricks behind it <a href="https://robjhyndman.com/papers/calendar-vis.pdf"><strong>here</strong></a>.</p>
<pre class="r"><code>library(sugrrants)

data_cal &lt;- data %&gt;% frame_calendar(
  x = Time, y = Count, date = Date, calendar = &quot;monthly&quot;
)

p &lt;- data_cal %&gt;%
  ggplot(aes(x = .Time, y = .Count, group = Date)) +
  geom_line() +
  theme(legend.position = &quot;bottom&quot;)

p</code></pre>
<p><img src="/post/2018-08-08-exploring-step-count-data-with-sugrrants_files/figure-html/first%20plot-1.png" width="672" /></p>
<p>The initial plot sort of resembles a calendar. However, we can make it look much more calendar like with the use of the <code>prettify</code> function, and voila! A calendar plot!</p>
<pre class="r"><code>prettify(p, label.padding = unit(0.08, &quot;lines&quot;))</code></pre>
<p><img src="/post/2018-08-08-exploring-step-count-data-with-sugrrants_files/figure-html/prettyfy-1.png" width="672" /></p>
</div>
<div id="a-slight-nuisance---time-zones" class="section level3">
<h3>4) A slight nuisance - time zones!</h3>
<p>If you look closely, even though you can see the general pattern that whilst I am away (9th July to 6th Aug) I am more active than the preceding weeks, the timing of my steps is all off due to me hopping around different time zones, and the data when exported being set to Sydney (GMT + 10) time! Oh dear!</p>
<center>
<p><img src="/img/travels.jpg" width="700px" /></p>
</center>
<p>Although I visited many different timezones at different times of the day (eg, on 24th July I went from GMT -6, to -4, to -5), I decided for days that I was in multiple time zones to pick one that described the day the best. For the month of July, I decided on the following, with a similar concept for August as well.</p>
<center>
<p><img src="/img/calendar.jpg" width="700px" /></p>
</center>
<p>So how do I account for this?</p>
<p>I decided I would shift my whole data set from key travel dates forward and back all at once, and then for subsequent travel dates I would keep on shifting forwards and back until all dates had been accounted for. I won’t put in all the R code, but I include the code I used to make the first shift to the time zone in Costa Rica (-16 hrs from Sydney). Dates that overlapped with Sydney after being shifted back were deleted so that the steps in Sydney time would be plotted, with Costa Rica steps starting at midnight on 9th July.</p>
<pre class="r"><code># First shift - all data post 9 July to CR time zone, -16hrs #

inds_shift &lt;- which(data$Date &gt;= as.Date(&quot;2018-07-09&quot;))
data_shift &lt;- data %&gt;% filter(Date &gt;= as.Date(&quot;2018-07-09&quot;))

data_shift &lt;- mutate_at(data_shift, vars(Finish), funs(.-hours(x=16)))
data_shift &lt;- mutate(data_shift, Date=date(Finish))
data_shift &lt;- mutate(data_shift, Time=hour(Finish))
head(data_shift)</code></pre>
<pre><code>##                Finish Count Time       Date
## 1 2018-07-08 08:00:00     0    8 2018-07-08
## 2 2018-07-08 09:00:00     0    9 2018-07-08
## 3 2018-07-08 10:00:00     0   10 2018-07-08
## 4 2018-07-08 11:00:00     0   11 2018-07-08
## 5 2018-07-08 12:00:00     0   12 2018-07-08
## 6 2018-07-08 13:00:00     0   13 2018-07-08</code></pre>
<pre class="r"><code>del &lt;- which(data_shift$Date==as.Date(&quot;2018-07-08&quot;))
inds_shift &lt;- inds_shift[-del]

data[inds_shift,] &lt;- data_shift[-del,]</code></pre>
<p>Implementing these shifts, we have a more reasonable looking calendar plot. Woohoo!</p>
<pre class="r"><code>data_cal &lt;- data %&gt;% frame_calendar(
  x = Time, y = Count, date = Date, calendar = &quot;monthly&quot;
)

p &lt;- data_cal %&gt;%
  ggplot(aes(x = .Time, y = .Count, group = Date)) +
  geom_line() +
  theme(legend.position = &quot;bottom&quot;)
prettify(p, label.padding = unit(0.08, &quot;lines&quot;))</code></pre>
<p><img src="/post/2018-08-08-exploring-step-count-data-with-sugrrants_files/figure-html/new%20plot-1.png" width="672" /></p>
</div>
<div id="add-in-some-colour" class="section level3">
<h3>5) Add in some colour!</h3>
<p>The last step I did was to colour the dates by what area/timezone I was in, by adding in a column called <code>Region</code> which I used in the plotting step to add a colour element. I also cleaned up and removed data from the 5th of August - I left SFO at 11pm on 4th August local time and arrived 6.30am in Sydney on 6th August - so data on that day did not make sense in either timezone.</p>
<pre class="r"><code>p &lt;- data_cal %&gt;%
  ggplot(aes(x = .Time, y = .Count, group = Date, colour=Region)) +
  geom_line() +
  theme(legend.position = &quot;bottom&quot;)
prettify(p, label.padding = unit(0.08, &quot;lines&quot;))</code></pre>
<p><img src="/post/2018-08-08-exploring-step-count-data-with-sugrrants_files/figure-html/color-1.png" width="672" /></p>
<p>What do you think? My steps definitely went up when I was away! Can you spot the time when I walked 8km in 30 degree heat from Wicker Park to downtown in Chicago? Or the day where it rained in Tortuguero all day in Costa Rica and the only walking I did was to see the turtle laying eggs at 8pm?</p>
<center>
<h2>
Take home message - eat that pizza when travelling - you’ll be back to a sloth when at home!
</h2>
</center>
<center>
<p><img src="/img/sloth.jpg" width="700px" /></p>
</center>
</div>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/data-viz/">data-viz</a>
  
</div>




    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

